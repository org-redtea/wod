!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.Wod={})}(this,function(exports){"use strict";var $global="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||void 0;function useThread(e){return function(r){return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.exec(r,n)}}}function hasWorker(){return"Worker"in $global}function encodeMessage(e){return{prog:e.prog.toString(),args:e.args}}function decodeMessage(data){var result={args:data.args};return result.prog=eval("result.prog = "+data.prog),result}var URL=$global.URL||$global.webkitURL;function createWorkerWithContent(e){try{try{var r;try{(r=new($global.BlobBuilder||$global.WebKitBlobBuilder||$global.MozBlobBuilder||$global.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(URL.createObjectURL(r))}catch(r){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){throw new Error("Inline worker is not supported")}}var workerCode="\n"+decodeMessage.toString()+";\n\nself.onmessage = function(event) {\n  var decoded = decodeMessage(event.data);\n  var prog = decoded.prog;\n  var args = decoded.args;\n  \n  prog.apply(self, args);\n}\n",Wod=function(){function e(){var r=this;if(!e.isPlatformSupportWorker)throw new Error("WebWorker is not supported");this.$thread=null,this.listeningThread=!1,this.listeners=[],this.onmessageListener=function(e){r.emit("message",e)},this.onerrorListener=function(e){r.emit("error",e)};var t=createWorkerWithContent(workerCode);this.$thread=t,this.listenThread()}e.spawn=function(){return new e};var r=e.prototype;return r.on=function(e,r){this.listeners.push([e,r])},r.off=function(e,r){var t=this.listeners.findIndex(function(t){return t[0]===e&&t[1]===r});-1!==t&&this.listeners.splice(t,1)},r.emit=function(e,r){var t=this.listeners.length;r=Array.isArray(r)?r:[r];for(var n=0;n<t;n++){var o=this.listeners[n];o[0]===e&&o[1].apply(o,r)}},r.listenThread=function(){if(!this.listeningThread&&e.isPlatformSupportWorker){var r=this.$thread;r.onmessage=this.onmessageListener,r.onerror=this.onerrorListener,this.listeningThread=!0}},r.unlistenThread=function(){if(this.listeningThread&&e.isPlatformSupportWorker){var r=this.$thread;r.onmessage=null,r.onerror=null,this.listeningThread=!1}},r.exec=function(r,t){e.isPlatformSupportWorker&&this.$thread.postMessage(encodeMessage({prog:r,args:t}))},r.terminate=function(){var e=this.$thread;this.unlistenThread(),this.listeners.length=0,e.terminate(),this.$thread=null},e}();Wod.isPlatformSupportWorker=hasWorker(),exports.Wod=Wod,exports.useThread=useThread,Object.defineProperty(exports,"__esModule",{value:!0})});
